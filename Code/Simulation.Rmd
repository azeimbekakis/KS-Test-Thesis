---
title: "R Notebook"
output: html_notebook
---

```{r}
library(xtable)
library(dgof)
```

```{r}
# Testing a simple random normal distribution
test_normal <- function(n_tests, n_samples) {
  results <- numeric(n_tests)
  for(i in 1:n_tests) {
    data <- rnorm(n_samples)
    results[i] <- ks.test(data, "pnorm")$p.value
  }
  #power_level <- 1 - sum(results < 0.05) / n_tests
  hist_title <- paste("P-values for n =", n_samples, "and", n_tests, "replicate tests")
  hist(results, main = hist_title, xlab = "P-value")
}

par(mfrow=c(3,2))
test_normal(10000, 10)
test_normal(10000, 100)
test_normal(10000, 1000)
test_normal(10, 10000)
test_normal(100, 10000)
test_normal(1000, 10000)
```

```{r}
test_rounded <- function(n_tests, n_samples, rounded) {
  results <- numeric(n_tests)
  for(i in 1:n_tests) {
    data <- round(rnorm(n_samples), rounded)
    results[i] <- ks.test(data, "pnorm")$p.value
  }
  #power_level <- 1 - sum(results < 0.05) / n_tests
  hist_title <- paste("P-values with", rounded, "rounded decimals")
  hist(results, main = hist_title, xlab = "P-value")
}

par(mfrow=c(2,2))
suppressWarnings(test_rounded(1000, 10000, 4))
suppressWarnings(test_rounded(1000, 10000, 3))
suppressWarnings(test_rounded(1000, 10000, 2))
suppressWarnings(test_rounded(1000, 10000, 1))
```

```{r}
test_correlation <- function(n_tests, ars) {
  for(i in 1:length(ars)) {
    ar_results <- numeric(n_tests)
    for(j in 1:n_tests) {
      data <- arima.sim(model = list(ar = ars[i]), rand.gen = rnorm, sd = sqrt(1-ars[i]^2), n = 500)
      ar_results[j] <- ks.test(data, "pnorm")$p.value
    }
    hist_title <- paste("AR coefficient", ars[i])
    hist(ar_results, main = hist_title, xlab = "P-value")
  }
}

ars <- seq(-0.5, 0.5, by = 0.1)
suppressWarnings(test_correlation(1000, ars))
```
```{r}
check_var <- function(phi) {
  data <- arima.sim(model = list(ar = phi), rand.gen = rnorm, sd = sqrt(1-phi^2), n = 10000)
  cat("ar = ", phi, "\n")
  cat("var = ", var(data), "\n")
  cat("sd = ", sd(data), "\n")
  cat("-----", "\n")
}

for (ar in seq(-0.95, 0.95, by = 0.05)) {
  check_var(ar)
}
```

```{r}
test_table <- function(n_tests, n_samples) {
  results <- numeric(n_tests)
  for(i in 1:n_tests) {
    data <- rnorm(n_samples)
    results[i] <- ks.test(data, "pnorm")$p.value
  }
  power_level <- 1 - sum(results < 0.05) / n_tests
  return(power_level)
}
Tests_Samples <- c("10000, 10", "10000, 100", "10000, 1000", "10, 10000", "100, 10000", "1000, 10000")
Power_Level <- c(0, 0, 0, 0, 0, 0)
tab <- data.frame(Tests_Samples, Power_Level)
tab[1, "Power_Level"] <- test_table(10000, 10)
tab[2, "Power_Level"] <- test_table(10000, 100)
tab[3, "Power_Level"] <- test_table(10000, 1000)
tab[4, "Power_Level"] <- test_table(10, 10000)
tab[5, "Power_Level"] <- test_table(100, 10000)
tab[6, "Power_Level"] <- test_table(1000, 10000)
tab <- xtable(tab)
tab
```